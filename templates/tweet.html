{% extends "base.html" %}

{% block title %}E-Neo: Tweets{% end %}

{% block nav %}
<ul class="nav navbar-nav">
  <li><a href="/">Home</a></li>
  <li><a href="/blogs">Blogs</a></li>
  <li class="active"><a href="#">Tweets</a></li>
  <li><a href="https://github.com/E-Neo">Github</a></li>
</ul>
{% end %}

{% block body %}
<div id="show" class="list-group"></div>
<div id="loading" class="container text-center">
  <h2>Loading...</h2>
</div>
<div id="more"></div>
{% end %}

{% block script %}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.6/marked.min.js"></script>
<script>
  $(document).ready(function () {
    var update_tweets = function (date_string) {
      $("#more").empty();
      $.post("/api/tweets", {
        current: date_string
      }, function (data) {
        var slugs = [];
        for (var key in data) {
          slugs.push(key);
        }
        slugs = slugs.sort();
        var current = false;
        if (slugs.length > 0) {
          current = data[slugs[0]][2];
        }
        $("#loading").hide();
        slugs.reverse().forEach(function (x) {
          $("#show").append('<div id="' + x
                            + '"><small>' + data[x][2] + '</small>'
                            + '<div class="list-group-item">'
                            + marked(data[x][1]) + '</div></div>');
        });
        if (current) {
          $("#more").append('<button type="button" class="btn btn-default center-block">More</button>');
          $("#more button").click(function () {
            $("#loading").show();
            update_tweets(current);
          });
        } else {
          $("#more").append('<p class="text-center">--- I am the bottom line. ---</p>');
        }
      }, "json");
    }
    update_tweets(new Date().toISOString());
  });
</script>
{% end %}
